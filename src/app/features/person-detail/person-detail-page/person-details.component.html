<div class="details-container pb-8">
    @if (personDetailStore.person$ | async; as person) {
        <section class="hero">
            @if (personDetailStore.heroBackdrop$ | async; as backdrop) {
                <app-media-thumb
                    class="hero-backdrop"
                    [alt]="person.name"
                    [src]="backdrop"
                    [params]="'w1920_and_h800_multi_faces'"
                ></app-media-thumb>
                <div class="hero-gradient"></div>
            } @else {
                <div class="hero-surface"></div>
            }

            <div class="hero-content inner-container">
                <app-media-thumb
                    class="person-portrait border-round-xl"
                    [src]="person.profile_path"
                    type="person"
                    [alt]="person.name"
                />
                <div class="person-info">
                    <h1 class="person-name">{{ person.name }}</h1>
                    <p class="muted m-0">{{ person.known_for_department }}</p>

                    @if (person.biography) {
                        <div class="biography-wrap">
                            <p
                                class="biography line-height-4 m-0"
                                [class.biography-collapsed]="!bioExpanded"
                            >
                                {{ person.biography }}
                            </p>
                            @if (isBioLong(person.biography)) {
                                <button
                                    class="bio-toggle"
                                    (click)="toggleBio()"
                                >
                                    {{
                                        bioExpanded ? "Show less" : "Show more"
                                    }}
                                </button>
                            }
                        </div>
                    }

                    <div class="person-footer">
                        <app-social-links
                            [links]="personDetailStore.links$ | async"
                            [item]="person"
                            [isPerson]="true"
                        />

                        @if (
                            personDetailStore.photosTotalCount$ | async;
                            as photoCount
                        ) {
                            @if (photoCount > 0) {
                                <button
                                    class="photos-stat"
                                    (click)="openPhotoViewer(0)"
                                >
                                    <i class="pi pi-images"></i>
                                    <span class="photos-stat-count">{{
                                        photoCount
                                    }}</span>
                                    <span class="photos-stat-label"
                                        >Photos</span
                                    >
                                </button>
                            }
                        }
                    </div>
                </div>
            </div>
        </section>

        <div class="inner-container flex flex-column gap-6 mt-6">
            @if (personDetailStore.hasCredits$ | async) {
                <section>
                    <div
                        class="flex align-items-center justify-content-between mb-3"
                    >
                        <h2 class="section-title m-0">Known For</h2>
                        <app-pill-toggle
                            [options]="
                                personDetailStore.creditsOptions$ | async
                            "
                            [selectedValue]="
                                personDetailStore.visibleCredits$ | async
                            "
                            (selected)="changeVisibleCredits($event)"
                        />
                    </div>
                    <app-carousel
                        [items]="(personDetailStore.knownFor$ | async)!"
                        [numVisible]="6"
                        [numScroll]="6"
                    >
                        <ng-template let-item>
                            <app-card
                                [item]="item"
                                [type]="item.media_type"
                                [role]="item.character || item.job"
                            />
                        </ng-template>
                    </app-carousel>
                </section>
            }

            @if (personDetailStore.pagedGroupedCredits$ | async; as groups) {
                @if (groups.length) {
                    <section class="credits-section">
                        <h2 class="section-title">Credits</h2>
                        @for (group of groups; track group.department) {
                            <div class="credits-dept">
                                <h3 class="credits-dept-heading">
                                    {{ group.department }}
                                </h3>
                                @if (group.upcoming.length) {
                                    <mat-expansion-panel>
                                        <mat-expansion-panel-header>
                                            <mat-panel-title>
                                                Upcoming ·
                                                {{ group.upcoming.length }}
                                            </mat-panel-title>
                                        </mat-expansion-panel-header>
                                        @for (
                                            credit of group.upcoming;
                                            track credit.id
                                        ) {
                                            <a
                                                class="credit-row"
                                                [routerLink]="[
                                                    '/title',
                                                    credit.id,
                                                    credit.mediaType,
                                                ]"
                                            >
                                                <app-media-thumb
                                                    class="credit-thumb"
                                                    [src]="credit.posterPath"
                                                    [alt]="credit.title"
                                                    type="media"
                                                ></app-media-thumb>
                                                <div class="credit-body">
                                                    <span
                                                        class="credit-title"
                                                        >{{
                                                            credit.title
                                                        }}</span
                                                    >
                                                    <div class="credit-meta">
                                                        @if (credit.rating) {
                                                            <app-rating
                                                                [value]="
                                                                    credit.rating
                                                                "
                                                            />
                                                        }
                                                        <mat-chip>{{
                                                            credit.mediaType ===
                                                            "tv"
                                                                ? "TV Series"
                                                                : "Movie"
                                                        }}</mat-chip>
                                                    </div>
                                                    @if (
                                                        credit.character ||
                                                        credit.job
                                                    ) {
                                                        <span
                                                            class="credit-role muted"
                                                        >
                                                            {{
                                                                credit.character ||
                                                                    credit.job
                                                            }}
                                                        </span>
                                                    }
                                                </div>
                                                <div class="credit-year muted">
                                                    @if (credit.year) {
                                                        {{ credit.year }}
                                                    }
                                                    @if (credit.episodeCount) {
                                                        <span
                                                            class="credit-episodes"
                                                            >{{
                                                                credit.episodeCount
                                                            }}
                                                            ep</span
                                                        >
                                                    }
                                                </div>
                                            </a>
                                        }
                                    </mat-expansion-panel>
                                }
                                @if (group.past.length) {
                                    <mat-expansion-panel [expanded]="true">
                                        <mat-expansion-panel-header>
                                            <mat-panel-title>
                                                Previous ·
                                                {{ group.past.length }}
                                            </mat-panel-title>
                                        </mat-expansion-panel-header>
                                        @for (
                                            credit of group.pagedPast;
                                            track credit.id
                                        ) {
                                            <a
                                                class="credit-row"
                                                [routerLink]="[
                                                    '/title',
                                                    credit.id,
                                                    credit.mediaType,
                                                ]"
                                            >
                                                <app-media-thumb
                                                    class="credit-thumb"
                                                    [src]="credit.posterPath"
                                                    [alt]="credit.title"
                                                    type="media"
                                                ></app-media-thumb>
                                                <div class="credit-body">
                                                    <span
                                                        class="credit-title"
                                                        >{{
                                                            credit.title
                                                        }}</span
                                                    >
                                                    <div class="credit-meta">
                                                        @if (credit.rating) {
                                                            <app-rating
                                                                [value]="
                                                                    credit.rating
                                                                "
                                                            />
                                                        }
                                                        <mat-chip>{{
                                                            credit.mediaType ===
                                                            "tv"
                                                                ? "TV Series"
                                                                : "Movie"
                                                        }}</mat-chip>
                                                    </div>
                                                    @if (
                                                        credit.character ||
                                                        credit.job
                                                    ) {
                                                        <span
                                                            class="credit-role muted"
                                                        >
                                                            {{
                                                                credit.character ||
                                                                    credit.job
                                                            }}
                                                        </span>
                                                    }
                                                </div>
                                                <div class="credit-year muted">
                                                    @if (credit.year) {
                                                        {{ credit.year }}
                                                    }
                                                    @if (credit.episodeCount) {
                                                        <span
                                                            class="credit-episodes"
                                                            >{{
                                                                credit.episodeCount
                                                            }}
                                                            ep</span
                                                        >
                                                    }
                                                </div>
                                            </a>
                                        }
                                        @if (group.past.length > 10) {
                                            <mat-paginator
                                                [length]="group.past.length"
                                                [pageSize]="10"
                                                [pageIndex]="
                                                    group.pastPageIndex
                                                "
                                                [hidePageSize]="true"
                                                [showFirstLastButtons]="true"
                                                (page)="
                                                    personDetailStore.setCreditPage(
                                                        {
                                                            department:
                                                                group.department,
                                                            index: $event.pageIndex,
                                                        }
                                                    )
                                                "
                                            />
                                        }
                                    </mat-expansion-panel>
                                }
                            </div>
                        }
                    </section>
                }
            }

            <section class="personal-details-section">
                <h2 class="section-title">Personal Details</h2>
                <ul class="details-list list-none pl-0 m-0">
                    @if (person.birthday) {
                        <li class="details-row">
                            <span class="details-label">Born</span>
                            <span>
                                {{ person.birthday | date }}
                                @if (!person.deathday) {
                                    <span class="muted">
                                        (age {{ person | age }})
                                    </span>
                                }
                            </span>
                        </li>
                    }
                    @if (person.deathday) {
                        <li class="details-row">
                            <span class="details-label">Died</span>
                            <span>
                                {{ person.deathday | date }}
                                <span class="muted"
                                    >(age {{ person | age }})</span
                                >
                            </span>
                        </li>
                    }
                    @if (person.place_of_birth) {
                        <li class="details-row">
                            <span class="details-label">Birthplace</span>
                            <span>{{ person.place_of_birth }}</span>
                        </li>
                    }
                    <li class="details-row">
                        <span class="details-label">Known For</span>
                        <span>{{ person.known_for_department }}</span>
                    </li>
                    @if (person.also_known_as?.length) {
                        <li class="details-row">
                            <span class="details-label">Alternative name</span>
                            <!-- <span>{{ person.also_known_as?.join(", ") }}</span> -->
                            <span>{{ person.also_known_as![0] }}</span>
                        </li>
                    }
                </ul>
            </section>

            @if (personDetailStore.photosTotalCount$ | async; as totalCount) {
                @if (totalCount > 0) {
                    <section class="photos-section">
                        <h2 class="section-title">
                            Photos
                            <span class="section-count">{{ totalCount }}</span>
                        </h2>
                        <app-photos-grid
                            [images]="personDetailStore.featuredPhotos$ | async"
                            [totalCount]="
                                (personDetailStore.photosTotalCount$ | async)!
                            "
                            (photoClick)="openPhotoViewer($event)"
                        />
                    </section>
                }
            }
        </div>
    }
</div>
