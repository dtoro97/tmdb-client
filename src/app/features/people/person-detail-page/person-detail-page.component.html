<div
  class="h-full details-container pb-4"
  [class.mobile]="globalStore.isMobile()"
>
  @if (person$ | async; as person) {
    <div class="relative backdrop-wrapper">
      @if (person.profile_path) {
        <img
          src="{{ person.profile_path | imgSrc: 'w500' }}"
          class="person-backdrop"
        />
      }
      <div class="gradient-cover"></div>
    </div>

    <div
      class="relative info-container md:ml-auto md:mr-auto md:px-8 px-4 w-full"
      [style.maxWidth.px]="1400"
    >
      <div class="flex md:flex-row flex-column">
        <div>
          <img
            src="{{ person.profile_path | imgSrc: 'w500' }}"
            class="profile-image border-round-lg"
          />
        </div>
        <div class="flex flex-column mt-2 md:mt-8 gap-2 md:ml-6 flex-1">
          <h1 class="m-0">{{ person.name }}</h1>
          <div
            class="flex flex-row gap-3 align-items-center flex-wrap person-meta"
          >
            @if (person.known_for_department) {
              <span class="meta-badge">{{ person.known_for_department }}</span>
            }
            @if (person.birthday) {
              <span>
                {{ person.birthday | date }}
                @if (!person.deathday) {
                  <span class="muted"> (age {{ person | age }})</span>
                }
              </span>
            }
            @if (person.deathday) {
              <span>
                Died {{ person.deathday | date }}
                <span class="muted">(age {{ person | age }})</span>
              </span>
            }
            @if (person.place_of_birth) {
              <span class="muted">{{ person.place_of_birth }}</span>
            }
          </div>
          <div class="mt-1">
            <app-social-links
              [links]="links$ | async"
              [item]="person"
              [isPerson]="true"
            ></app-social-links>
          </div>
          @if (person.biography) {
            <div class="mt-2 biography-container" [style.maxWidth.px]="700">
              <p
                class="m-0 line-height-4 biography-text"
                [class.clamped]="!bioExpanded"
              >
                {{ person.biography }}
              </p>
              <span class="read-more-btn" (click)="toggleBio()">
                {{ bioExpanded ? "Show less" : "Read more" }}
              </span>
            </div>
          }
        </div>
      </div>
    </div>

    <div
      class="tab-content md:ml-auto md:mr-auto md:px-8 px-4 mt-4"
      [style.maxWidth.px]="1400"
    >
      @if (hasCredits$ | async) {
        <div class="detail-section">
          <div class="section-header mb-3">
            <h2 class="section-title">Known For</h2>
          </div>
          <div class="pill-toggle mb-4">
            <app-pill-toggle
              [options]="creditsOptions$ | async"
              [selectedValue]="visibleCredits$ | async"
              (selected)="changeVisibleCredits($event)"
            ></app-pill-toggle>
          </div>

          @for (group of knownForGroups$ | async; track group.year) {
            <div class="known-for-year-group">
              <div class="known-for-year-label">{{ group.year }}</div>
              <div class="known-for-year-items">
                @for (item of group.items; track item.id) {
                  <app-card [item]="item" [type]="item.media_type"></app-card>
                }
              </div>
            </div>
          }
        </div>
      }

      @if (hasCredits$ | async) {
        <div class="detail-section">
          <h2 class="section-title mb-3">Credits</h2>
          <app-credits-list [credits]="credits$ | async"></app-credits-list>
        </div>
      }

      @if (personDetailStore.photoCount$ | async; as count) {
        <div class="detail-section">
          <div class="section-header mb-3">
            <h2 class="section-title">Photos</h2>
            <span class="view-all-btn" (click)="openGalleria(allPhotos)">
              View All ({{ count }})
              <i class="fa-solid fa-images"></i>
            </span>
          </div>
          <div
            class="flex flex-wrap gap-3 justify-content-center md:justify-content-start"
          >
            @for (
              image of personDetailStore.photoPreviews$ | async;
              track image.file_path;
              let i = $index
            ) {
              <img
                class="person-photo cursor-pointer"
                src="{{ image.file_path | imgSrc }}"
                (click)="openGalleria(allPhotos, i)"
              />
            }
          </div>
        </div>
      }
    </div>
  }
</div>

<p-galleria
  [(value)]="galleriaImages"
  [visible]="galleriaVisible"
  (visibleChange)="onGalleriaClose()"
  [(activeIndex)]="galleriaActiveIndex"
  [fullScreen]="true"
  [showThumbnails]="!globalStore.isMobile()"
  [showItemNavigators]="true"
  [circular]="true"
  [numVisible]="7"
  [responsiveOptions]="[
    { breakpoint: '768px', numVisible: 5 },
    { breakpoint: '480px', numVisible: 3 },
  ]"
>
  <ng-template pTemplate="item" let-item>
    <img [src]="item.source" class="galleria-main-image" />
  </ng-template>
  <ng-template pTemplate="thumbnail" let-item>
    <img [src]="item.thumbnail" class="galleria-thumbnail" />
  </ng-template>
</p-galleria>
