<div class="discover-page">
  <div class="discover-header">
    <div class="section-header">
      <h2>Discover</h2>
    </div>
    <app-pill-toggle
      [options]="typeOptions"
      [selectedValue]="currentType"
      (selected)="switchType($event)"
    ></app-pill-toggle>
  </div>

  <div class="filter-bar">
    <p-select
      appendTo="body"
      [options]="sortOptions$ | async"
      [ngModel]="discoverStoreService.sortBy$ | async"
      (ngModelChange)="onSortChange($event)"
      optionLabel="label"
      optionValue="value"
      placeholder="Sort by"
      styleClass="sort-select"
    ></p-select>

    <div class="genre-chips">
      @for (genre of genres$ | async; track genre.id) {
        <button
          class="genre-chip"
          [class.active]="genre.selected"
          (click)="toggleGenreSelection(genre)"
        >
          {{ genre.name }}
        </button>
      }
    </div>

    <button
      class="filter-toggle-btn"
      [class.active]="showAdvancedFilters"
      (click)="toggleAdvancedFilters()"
    >
      <i class="fa-solid fa-sliders"></i>
      {{ showAdvancedFilters ? "Hide Filters" : "More Filters" }}
    </button>
  </div>

  @if (showAdvancedFilters) {
    <div class="advanced-filters">
      <div class="filter-group">
        <label class="filter-label">
          {{ currentType === "tv" ? "Air Dates" : "Release Date" }}
        </label>
        <div class="date-range">
          <div class="date-field">
            <span class="date-label">From</span>
            <p-date-picker
              appendTo="body"
              [ngModel]="discoverStoreService.fromDate$ | async"
              (ngModelChange)="onFromDateChange($event)"
              dateFormat="yy-mm-dd"
              placeholder="Start date"
              styleClass="compact-date"
            ></p-date-picker>
          </div>
          <div class="date-field">
            <span class="date-label">To</span>
            <p-date-picker
              appendTo="body"
              [ngModel]="discoverStoreService.toDate$ | async"
              (ngModelChange)="onToDateChange($event)"
              dateFormat="yy-mm-dd"
              placeholder="End date"
              styleClass="compact-date"
            ></p-date-picker>
          </div>
        </div>
      </div>

      <div class="filter-group">
        <label class="filter-label">
          User Score: {{ (discoverStoreService.voteAverage$ | async)?.[0] }} â€”
          {{ (discoverStoreService.voteAverage$ | async)?.[1] }}
        </label>
        <p-slider
          [ngModel]="discoverStoreService.voteAverage$ | async"
          (ngModelChange)="onVoteAverageChange($event)"
          [step]="1"
          [min]="0"
          [max]="10"
          [range]="true"
          styleClass="w-full"
        />
      </div>

      <div class="filter-group">
        <label class="filter-label">
          Minimum Votes: {{ discoverStoreService.minVoteCount$ | async }}
        </label>
        <p-slider
          [ngModel]="discoverStoreService.minVoteCount$ | async"
          (ngModelChange)="onMinVoteCountChange($event)"
          [step]="10"
          [min]="0"
          [max]="500"
          styleClass="w-full"
        />
      </div>
    </div>
  }

  @if ((discoverStoreService.data$ | async)?.length) {
    <div class="results-grid">
      @for (item of discoverStoreService.data$ | async; track item.id) {
        <app-card [item]="item" [type]="type$ | async"></app-card>
      }
    </div>
  }

  @if ((discoverStoreService.total$ | async)! > 20) {
    <div class="paginator-wrapper">
      <p-paginator
        [first]="discoverStoreService.skip$ | async"
        [rows]="20"
        [totalRecords]="discoverStoreService.total$ | async"
        [alwaysShow]="false"
        (onPageChange)="onPageChange($event)"
      ></p-paginator>
    </div>
  }
</div>
