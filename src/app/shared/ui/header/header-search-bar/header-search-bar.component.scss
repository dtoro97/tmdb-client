@use "responsive.scss" as *;

:host {
    display: contents;
}

.search-container {
    width: 100%;
    position: relative;
}

.search-wrap {
    display: flex;
    align-items: center;
    background: var(--mat-sys-surface-container);
    border: 1px solid var(--mat-sys-outline);
    border-radius: 8px;
    height: 38px;
    overflow: hidden;
    transition: border-color 0.2s;

    &:focus-within {
        border-color: var(--primary-color);
    }
}

.filter-field,
.search-field {
    height: 100%;

    ::ng-deep {
        .mdc-notched-outline__leading,
        .mdc-notched-outline__notch,
        .mdc-notched-outline__trailing {
            border-color: transparent !important;
        }

        .mat-mdc-form-field-infix {
            padding-top: 7px;
            padding-bottom: 7px;
            min-height: unset;
        }

        .mat-mdc-text-field-wrapper {
            height: 38px;
            padding: 0;
        }

        .mat-mdc-form-field-flex {
            height: 100%;
            align-items: center;
        }

        .mdc-text-field {
            padding-left: 8px;
            padding-right: 4px;
        }
    }
}

.filter-field {
    flex-shrink: 0;

    ::ng-deep {
        .mdc-text-field {
            border-right: 1px solid var(--mat-sys-outline);
            border-radius: 8px 0 0 8px;
        }

        .mat-mdc-select-value {
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--mat-sys-on-surface-variant);
            white-space: nowrap;
        }

        .mat-mdc-select-arrow {
            margin-left: 4px;
        }

        .mat-mdc-form-field-infix {
            width: auto;
        }
    }
}

.search-field {
    flex: 1;
    min-width: 0;

    ::ng-deep {
        .mdc-text-field {
            border-radius: 0 8px 8px 0;
        }

        input.mat-mdc-input-element {
            font-size: 0.875rem;
            color: var(--mat-sys-on-surface);

            &::placeholder {
                color: var(--mat-sys-on-surface-variant);
            }
        }

        .mat-mdc-form-field-icon-prefix {
            padding-left: 4px;
            color: var(--mat-sys-on-surface-variant);

            mat-icon {
                font-size: 1.1rem;
                width: 1.1rem;
                height: 1.1rem;
                padding: 0;
            }
        }
    }
}

.search-close-btn {
    display: none;
    color: var(--mat-sys-on-surface-variant);
}

.search-dropdown {
    position: absolute;
    top: calc(100% + 6px);
    left: 0;
    right: 0;
    background: var(--mat-sys-surface-container);
    border: 1px solid var(--mat-sys-outline);
    border-radius: 8px;
    overflow: hidden;
    z-index: 1001;
    max-height: 480px;
    overflow-y: auto;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
}

:host ::ng-deep {
    .search-result {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        padding: 0.75rem 1rem;
        cursor: pointer;
        border-bottom: 1px solid var(--mat-sys-outline-variant);

        &:last-child {
            border-bottom: none;
        }

        &:hover {
            background: var(--mat-sys-outline-variant);
        }

        .result-thumb {
            width: 54px;
            height: 80px;
        }

        .result-info {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
            overflow: hidden;
            flex: 1;
            padding-top: 0.1rem;
        }

        .result-meta {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;

            app-rating {
                display: flex;
            }
        }

        .result-year {
            font-size: 0.75rem;
            color: var(--mat-sys-on-surface-variant);
        }

        .result-dept {
            font-size: 0.75rem;
            color: var(--mat-sys-on-surface-variant);
        }

        .result-title {
            font-size: 0.9rem;
            font-weight: 600;
            line-height: 1.3;
            color: var(--mat-sys-on-surface);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .result-overview {
            font-size: 0.8rem;
            color: var(--mat-sys-on-surface-variant);
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .rating {
            font-size: 0.8rem;

            mat-icon {
                font-size: 0.95rem;
                width: 0.95rem;
                height: 0.95rem;
            }
        }
    }
}

.search-toggle-btn {
    display: none;
    color: var(--mat-sys-on-surface-variant);

    &:hover {
        color: var(--mat-sys-on-surface);
    }
}

@include mobile() {
    .search-container {
        display: none;
        position: absolute;
        inset: 0;
        padding: 0 1rem;
        background: var(--mat-sys-surface-dim);
        align-items: center;
        gap: 0.5rem;
        z-index: 10;

        &.search-open {
            display: flex;

            .search-wrap {
                flex: 1;
            }

            .search-close-btn {
                display: inline-flex;
            }
        }
    }

    .search-toggle-btn {
        display: inline-flex;
        margin-left: auto;
    }
}
